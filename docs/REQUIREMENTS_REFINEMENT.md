# 需求细化文档 - 基于访谈结果

> 本文档基于2026-01-15的产品访谈，详细记录了关键业务决策和实现细节

---

## 1. 用户认证与登录

### 1.1 支持的登录方式

根据访谈结果，系统需要支持以下4种登录方式：

#### 1.1.1 手机号 + 验证码登录

**实现要点：**

- 集成短信服务商（阿里云、腾讯云等）
- 验证码有效期：5分钟
- 同一手机号限制：1分钟内只能发送1次
- 验证码长度：6位数字
- 需要图形验证码防止恶意请求

**成本考虑：**

- 短信费用约0.03-0.05元/条
- 建议设置每日发送上限

**用户体验：**

- 最便捷的登录方式
- 适合快速注册和登录
- 无需记忆密码

#### 1.1.2 邮箱 + 密码登录

**实现要点：**

- 邮箱格式验证
- 密码强度要求：
  - 最少6位
  - 必须包含字母和数字
  - 可选：包含特殊字符
- 密码加密：bcrypt
- 支持找回密码（邮箱验证）

**用户体验：**

- 传统登录方式
- 成本低
- 适合长期使用

#### 1.1.3 微信扫码登录

**实现要点：**

- 需要申请微信开放平台账号
- 获取用户unionid和openid
- 首次登录需要绑定手机号或邮箱
- 支持微信授权获取头像和昵称

**技术要求：**

- 微信开放平台认证（需要企业资质）
- 实现OAuth 2.0授权流程
- 处理授权回调

**用户体验：**

- 适合中国用户
- 一键登录，无需输入
- 可以获取微信头像作为默认头像

#### 1.1.4 游客模式

**实现要点：**

- 无需注册，直接使用
- 生成临时游客ID（存储在localStorage）
- 功能限制：
  - ✅ 可以播放音频
  - ✅ 可以使用播放器功能（变速、AB循环）
  - ❌ 不保存学习进度
  - ❌ 不能收藏
  - ❌ 不能查看学习统计
  - ❌ 不能访问付费内容
- 提示用户注册以保存数据

**转化策略：**

- 播放结束后提示注册
- 使用一段时间后提示注册
- 尝试使用高级功能时提示注册

---

## 2. 课堂扫码场景

### 2.1 多人扫码策略：每人独立播放

**场景描述：**

- 老师在课堂上展示二维码
- 多个学生同时扫码
- 每个学生独立控制自己的播放进度

**技术实现：**

- 每个用户独立的播放会话
- 不需要实时同步
- 服务器压力相对较小

**优点：**

- 实现简单
- 学生可以按自己的节奏学习
- 适合自主学习场景

**缺点：**

- 老师无法统一控制
- 不适合需要全班同步的场景

**建议：**

- MVP阶段采用此方案
- 后续可以考虑增加"同步模式"作为可选功能

---

## 3. 内容访问权限

### 3.1 部分免费 + 部分付费模式

**免费内容：**

- 基础课本的部分单元
- 试听内容
- 公开课程

**付费内容：**

- 完整课本内容
- 高级课程
- 专项训练

**会员体系（后续考虑）：**

- 月度会员：¥19.9/月
- 季度会员：¥49.9/季（优惠17%）
- 年度会员：¥149.9/年（优惠37%）

**权限控制：**

```sql
-- 课本表增加字段
textbooks:
  - is_free: boolean (是否完全免费)
  - free_units_count: integer (免费单元数量)

-- 单元表增加字段
units:
  - is_free: boolean (是否免费)
  - requires_vip: boolean (是否需要会员)
```

**实现策略：**

- MVP阶段：全部免费，专注功能开发
- 第二阶段：引入付费内容
- 第三阶段：完善会员体系

---

## 4. 二维码使用场景

### 4.1 三种场景都重要

#### 4.1.1 纸质课本印刷

**需求：**

- 高清二维码（至少300dpi）
- 永久有效
- 可以批量导出为PDF
- 支持自定义Logo和样式

**技术要点：**

- 二维码尺寸：2cm x 2cm（推荐）
- 容错率：H级（30%）
- 格式：矢量图（SVG）或高清PNG

**导出模板：**

- A4纸模板：每页6个二维码
- 包含课程名称和二维码
- 可以自定义布局

#### 4.1.2 电子课件展示

**需求：**

- 清晰可扫
- 可以嵌入PPT
- 支持投影仪展示

**技术要点：**

- 二维码尺寸：适中（屏幕的1/4）
- 提供多种尺寸下载
- 支持PNG、SVG格式

#### 4.1.3 社交分享传播

**需求：**

- 美观的分享卡片
- 包含课程信息和二维码
- 可以分享到微信、QQ等

**技术要点：**

- 生成分享海报
- 包含课程封面、名称、二维码
- 支持保存到相册

---

## 5. 音频文件管理

### 5.1 支持的音频格式

根据访谈，需要支持以下4种格式：

#### 5.1.1 MP3（推荐）

- 最常见的格式
- 兼容性最好
- 文件大小适中
- **作为标准输出格式**

#### 5.1.2 M4A/AAC

- Apple设备常用
- 音质好，文件小
- 需要转码为MP3

#### 5.1.3 WAV

- 无损音质
- 文件大
- 需要转码为MP3

#### 5.1.4 OGG

- 开源格式
- 音质好，文件小
- 部分老设备不支持
- 需要转码为MP3

### 5.2 音频处理流程

```
用户上传 → 格式检测 → 转码为MP3 → 压缩优化 → 存储 → CDN分发
```

**转码参数：**

- 格式：MP3
- 比特率：128kbps（标准）或 192kbps（高质量）
- 采样率：44.1kHz
- 声道：立体声

**工具选择：**

- FFmpeg（服务端转码）
- 或使用云服务（阿里云、腾讯云的音视频处理服务）

---

## 6. 字幕功能

### 6.1 可切换显示模式

用户可以在以下3种模式之间切换：

#### 6.1.1 仅英文模式

```
Hello, how are you?
```

#### 6.1.2 仅中文模式

```
你好，你好吗？
```

#### 6.1.3 双语对照模式

```
Hello, how are you?
你好，你好吗？
```

### 6.2 字幕文件格式

**支持格式：**

- SRT（推荐）
- VTT
- JSON（自定义格式）

**SRT格式示例：**

```srt
1
00:00:00,000 --> 00:00:03,000
Hello, how are you?
你好，你好吗？

2
00:00:03,000 --> 00:00:06,000
I'm fine, thank you.
我很好，谢谢。
```

**JSON格式示例：**

```json
{
  "subtitles": [
    {
      "start": 0,
      "end": 3,
      "en": "Hello, how are you?",
      "zh": "你好，你好吗？"
    },
    {
      "start": 3,
      "end": 6,
      "en": "I'm fine, thank you.",
      "zh": "我很好，谢谢。"
    }
  ]
}
```

### 6.3 字幕交互

- 点击字幕跳转到对应时间点
- 高亮当前播放的字幕
- 支持字体大小调节
- 支持滚动查看所有字幕

---

## 7. 学习数据统计

### 7.1 需要记录的数据

根据访谈，重点关注以下3类数据：

#### 7.1.1 学习时长统计

**记录维度：**

- 每日学习时长
- 每周学习时长
- 每月学习时长
- 累计学习时长

**展示方式：**

- 折线图：显示学习趋势
- 柱状图：对比每日时长
- 数字卡片：总时长、平均时长

**数据表设计：**

```sql
learning_stats:
  - user_id
  - date
  - total_duration (秒)
  - lessons_completed
```

#### 7.1.2 连续学习天数

**计算规则：**

- 每天至少学习5分钟才算有效
- 连续天数中断后重新计算
- 显示当前连续天数和历史最长连续天数

**激励机制：**

- 连续7天：获得"坚持学习"徽章
- 连续30天：获得"学习达人"徽章
- 连续100天：获得"学习大师"徽章

#### 7.1.3 学习报告生成

**周报内容：**

- 本周学习天数
- 本周学习时长
- 完成课程数
- 学习时段分布
- 对比上周数据

**月报内容：**

- 本月学习天数
- 本月学习时长
- 完成课程数
- 学习进步曲线
- 对比上月数据

**报告格式：**

- 网页版：可以在线查看
- 图片版：可以分享到社交媒体
- PDF版：可以下载保存

---

## 8. 内容管理方式

### 8.1 完全手动上传

**管理员操作流程：**

1. 登录后台管理系统
2. 选择课本和单元
3. 创建课程
4. 上传音频文件
5. 上传字幕文件（可选）
6. 填写课程信息
7. 预览和测试
8. 发布

**上传界面设计：**

- 拖拽上传
- 进度条显示
- 支持批量上传（最多20个）
- 上传失败重试

**文件验证：**

- 格式检查
- 大小检查（单个文件最大100MB）
- 音频时长提取
- 自动生成缩略图（波形图）

---

## 9. 技术架构决策

### 9.1 部署方式：自建服务器

**服务器配置建议（小型试点）：**

- CPU：4核
- 内存：8GB
- 硬盘：500GB SSD
- 带宽：10Mbps

**软件环境：**

- 操作系统：Ubuntu 22.04 LTS
- Web服务器：Nginx
- 数据库：PostgreSQL 15
- Node.js：20.x LTS

**成本估算：**

- 云服务器：约300-500元/月
- 域名：约50-100元/年
- SSL证书：免费（Let's Encrypt）

### 9.2 目标用户规模：小型试点（100-1000用户）

**性能目标：**

- 并发用户：100人
- 页面加载时间：< 2秒
- 音频播放延迟：< 500ms
- 数据库查询：< 100ms

**扩展计划：**

- 初期：单服务器
- 增长期：数据库分离
- 成熟期：负载均衡 + 多服务器

### 9.3 开发优先级：快速上线 MVP

**MVP核心功能（第一阶段，2-3周）：**

1. 用户注册登录（邮箱+密码）
2. 课本、单元、课程三层结构
3. 基础音频播放器
4. 扫码访问功能
5. 简单的后台管理

**第二阶段（2-3周）：**

1. 变速播放
2. AB循环
3. 断点续播
4. 字幕显示
5. 收藏功能

**第三阶段（2-3周）：**

1. 学习数据统计
2. 学习报告
3. 手机号登录
4. 微信登录
5. 游客模式

### 9.4 移动端形态：响应式网页

**设计原则：**

- Mobile First（移动优先）
- 适配主流屏幕尺寸
- 触摸友好的交互

**断点设置：**

- 手机：< 640px
- 平板：640px - 1024px
- 桌面：> 1024px

**移动端优化：**

- 大按钮（最小44x44px）
- 简化导航
- 底部固定播放器
- 手势操作（滑动切换）

---

## 10. 播放器功能细节

### 10.1 AB循环：两种都支持

#### 10.1.1 手动设置AB点

**操作流程：**

1. 播放到想要的位置
2. 点击"设置A点"按钮
3. 继续播放到结束位置
4. 点击"设置B点"按钮
5. 自动开始循环播放

**界面显示：**

- 进度条上标记A点和B点
- 显示AB区间的时长
- 显示循环次数
- 提供"清除AB点"按钮

#### 10.1.2 按句子自动循环

**前提条件：**

- 必须有字幕文件
- 字幕按句子分段

**操作流程：**

1. 显示字幕列表
2. 用户点击某个句子
3. 自动设置该句子的起止时间为AB点
4. 开始循环播放

**界面显示：**

- 字幕列表
- 高亮当前循环的句子
- 显示循环次数
- 可以快速切换到其他句子

### 10.2 播放器界面：简洁播放器

**设计原则：**

- 大按钮，易于点击
- 清晰的视觉层次
- 减少干扰元素
- 适合儿童使用

**核心元素：**

- 大的播放/暂停按钮（中心位置）
- 清晰的进度条
- 时间显示（当前/总时长）
- 音量控制（简化）
- 速度选择（图标+数字）
- AB循环按钮

**隐藏的高级功能：**

- 播放列表（可展开）
- 字幕设置（可展开）
- 更多选项（菜单）

**配色方案：**

- 主色：明亮的蓝色
- 按钮：大而圆润
- 图标：简洁可爱

---

## 11. 二维码管理

### 11.1 有效期：灵活配置

**默认设置：**

- 新生成的二维码默认永久有效
- 适合纸质课本印刷

**可选设置：**

- 管理员可以为每个二维码设置有效期
- 有效期选项：
  - 永久有效
  - 1天
  - 7天
  - 30天
  - 自定义日期

**过期处理：**

- 扫描过期二维码显示提示信息
- 提供重新生成的入口
- 管理员可以延长有效期

**使用场景：**

- 永久有效：纸质课本
- 临时有效：课堂分享、限时活动

---

## 12. 数据备份策略

### 12.1 每日自动备份

**备份内容：**

- 数据库完整备份
- 用户上传的文件（音频、图片）
- 系统配置文件

**备份时间：**

- 每天凌晨3:00自动执行
- 避开用户使用高峰期

**备份保留：**

- 保留最近7天的备份
- 每周日的备份额外保留4周
- 每月1日的备份额外保留12个月

**备份存储：**

- 本地服务器：最近3天
- 云存储（阿里云OSS/腾讯云COS）：所有备份
- 异地备份：每周备份

**恢复测试：**

- 每月进行一次恢复测试
- 确保备份可用

---

## 13. MVP开发计划

### 13.1 第一阶段：核心功能（2-3周）

**Week 1：基础架构**

- [ ] 项目初始化（Next.js + Supabase）
- [ ] 数据库设计和创建
- [ ] 用户认证系统（邮箱+密码）
- [ ] 基础UI框架搭建

**Week 2：内容管理**

- [ ] 后台管理界面
- [ ] 课本、单元、课程CRUD
- [ ] 音频文件上传
- [ ] 二维码生成

**Week 3：播放功能**

- [ ] 音频播放器（基础功能）
- [ ] 扫码访问流程
- [ ] 播放列表
- [ ] 测试和优化

### 13.2 第二阶段：高级功能（2-3周）

**Week 4：播放器增强**

- [ ] 变速播放
- [ ] AB循环（手动+自动）
- [ ] 断点续播
- [ ] 字幕显示（可切换）

**Week 5：用户功能**

- [ ] 收藏功能
- [ ] 播放历史
- [ ] 个人中心
- [ ] 移动端适配

**Week 6：测试和优化**

- [ ] 功能测试
- [ ] 性能优化
- [ ] Bug修复
- [ ] 用户体验优化

### 13.3 第三阶段：数据和扩展（2-3周）

**Week 7：数据统计**

- [ ] 学习时长统计
- [ ] 连续学习天数
- [ ] 学习报告生成
- [ ] 数据可视化

**Week 8：多登录方式**

- [ ] 手机号+验证码登录
- [ ] 微信扫码登录
- [ ] 游客模式
- [ ] 登录方式切换

**Week 9：上线准备**

- [ ] 服务器部署
- [ ] 域名和SSL配置
- [ ] 数据备份设置
- [ ] 监控和日志
- [ ] 正式上线

---

## 14. 关键技术决策总结

| 决策项   | 选择                               | 理由                           |
| -------- | ---------------------------------- | ------------------------------ |
| 登录方式 | 邮箱+密码、手机+验证码、微信、游客 | 满足不同用户需求，降低使用门槛 |
| 扫码策略 | 每人独立播放                       | 实现简单，适合MVP              |
| 访问权限 | 部分免费+部分付费                  | 平衡用户增长和收入             |
| 音频格式 | 支持多种，统一转为MP3              | 兼容性最好                     |
| 字幕显示 | 可切换（英文/中文/双语）           | 灵活满足不同学习需求           |
| 学习数据 | 时长、连续天数、报告               | 核心激励指标                   |
| 内容管理 | 完全手动上传                       | 保证内容质量                   |
| 部署方式 | 自建服务器                         | 成本可控                       |
| 用户规模 | 100-1000（小型试点）               | 快速验证，逐步扩展             |
| 开发策略 | 快速上线MVP                        | 快速验证，迭代优化             |
| 移动端   | 响应式网页                         | 开发成本低，覆盖面广           |
| AB循环   | 手动+自动两种                      | 满足不同使用场景               |
| 二维码   | 灵活配置有效期                     | 适应不同使用场景               |
| 播放器   | 简洁设计                           | 适合儿童使用                   |
| 备份策略 | 每日自动备份                       | 数据安全保障                   |

---

## 15. 风险和注意事项

### 15.1 技术风险

- **音频转码性能**：大量上传时可能造成服务器压力
  - 解决：使用队列异步处理
- **并发播放**：100人同时播放可能带宽不足
  - 解决：使用CDN加速

### 15.2 业务风险

- **版权问题**：音频内容版权需要明确
  - 解决：与出版社签订授权协议
- **用户增长**：小范围试点可能用户增长缓慢
  - 解决：与学校合作推广

### 15.3 成本风险

- **短信费用**：手机验证码登录会产生持续成本
  - 解决：设置合理的发送限制
- **存储成本**：音频文件占用空间大
  - 解决：音频压缩，定期清理无用文件

---

## 16. 下一步行动

1. ✅ 完成需求访谈和文档整理
2. ⏳ 创建详细的技术架构文档
3. ⏳ 设计数据库表结构
4. ⏳ 创建UI设计稿
5. ⏳ 搭建开发环境
6. ⏳ 开始MVP开发

---

**文档版本：** v1.0
**创建日期：** 2026-01-15
**最后更新：** 2026-01-15
**负责人：** 产品团队
